<body>
    <div class="hosts-container"></div>
</body>

<script>
    const hosts = JSON.parse(localStorage.getItem('hosts') || '[]');

    function createHostCard(host){
        const hostCard = document.createElement('div');
        hostCard.innerHTML = `<div>${host.name}</div>`;

        hostCard.addEventListener('click', () => {
            window.location.href = `${host.url}`;
        });

        return hostCard;
    };

    // add any hosts that might be in the query params
    const params = new URLSearchParams(window.location.search);
    if(params.has('h') && params.has('e') && params.has('m')){
        const url  = decodeURIComponent(params.get('h'));
        const aes  = params.get('e').replace(/-/g, '+').replace(/_/g, '/');
        const hmac = params.get('m').replace(/-/g, '+').replace(/_/g, '/');
        window.history.replaceState({}, '', window.location.pathname);

        const existingHost = hosts.find(host => host.url === url);
        if(existingHost){
            existingHost.url  = url;
            existingHost.aes  = aes;
            existingHost.hmac = hmac;
        }else{
            let newHostName = 'New Host';
            let i = 0;
            while(hosts.find(host => host.name === newHostName)){ newHostName = `New Host (${++i})`; }

            hosts.push({name:newHostName, url, aes, hmac});
            localStorage.setItem('hosts', JSON.stringify(this.hosts));
        }
    }

    const hostsContainer = document.querySelector('.hosts-container');
    for(const host of hosts){ hostsContainer.appendChild(createHostCard(host)); }
</script>

<style>
    .hosts-container{
        display: grid;
    }
</style>